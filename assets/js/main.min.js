$(document).ready(function(){
	var lvl = [2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 8]
	var $loading_page =  $('#loading')
	var $index_page = $('#index')
	var $room_page = $('#room')
	var $dialog_page = $('#dialog')
	var $pause = $('.pause')
	var $gameover = $('.gameover')
	var time = 60, bonus_time = 5
	var $time_item = $('.time')
	var $score = $('#room em')
	var now_score = 0
	var $box_area = $('#box')
	$loading_page.addClass('hide')
	$index_page.removeClass('hide')
	$box_area.height($(window).width())

	$('.play-btn,.btn-restart').click(function() {
		now_score = 0
		got_a_score(now_score)
		$index_page.addClass('hide')
		$dialog_page.addClass('hide')
		$room_page.attr('class', 'page')
		var now_time = time
		$time_item.html(now_time)
		var count_down = setInterval(check_game_over, 1000)
		$('.btn-pause').click(function() {
			clearInterval(count_down)
			$dialog_page.removeClass('hide')
			$pause.removeClass('hide'),$gameover.addClass('hide')
		});
		$('.btn-resume').click(function() {
			count_down = setInterval(check_game_over, 1000)
			$dialog_page.addClass('hide')
			$room_page.removeClass('hide')
		});
		$('.btn-more').click(function() {
			alert('敬请期待！')
		});
		function check_game_over() {
			now_time--
			if (now_time < 0){
				clearInterval(count_down)
				$room_page.addClass('hide')
				$dialog_page.removeClass('hide')
				$gameover.removeClass('hide'),$pause.addClass('hide')
				$('.gameover .score').html(now_score)
				$()////
			}
			$time_item.html(now_time)
		}

		function add_colors(sq) {
			var correct_one = get_random(sq*sq-1)
			var r = get_random(255), g = get_random(255), b = get_random(255)
			var cr = r + 25 < 255 ? r + 25 : 255
			var cg = g + 25 < 255 ? g + 25 : 255
			var cb = b + 25 < 255 ? b + 25 : 255
			for (var i = 0; i < sq*sq; i++) {
				if (i != correct_one){
					$box_area.append('<span style="background: rgb('+r+','+g+','+b+');"></span>')
				}else{
					$box_area.append('<span class="cor" style="background: rgb('+cr+','+cg+','+cb+');"></span>')
				}
			}
			$('.cor').click(function() {
				now_score++
				if (now_score % 10 == 0) now_time += 3
				got_a_score(now_score)
			});
		}

		function got_a_score(x) {
			$score.html(x)
			var sq = x < lvl.length ? lvl[x] : 9
			$box_area.attr('class', 'lv' + sq)
			clean_colors()
			add_colors(sq)
		}
	});  //start the game init

	function get_random(x) {
		return Math.floor(Math.random() * x + 1)
	}

	function clean_colors() {
		$('#box *').remove()
	}

	

	

})
